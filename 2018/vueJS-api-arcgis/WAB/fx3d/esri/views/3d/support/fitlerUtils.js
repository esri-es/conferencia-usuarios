/**
 * Copyright @ 2018 Esri.
 * All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 */
define(["dojo/_base/lang","esri/core/Collection"],function(e,t){var r=Object.prototype.hasOwnProperty,n=function(e,t){return t=t||{},t.queryObj=t.queryObj||null,t.queryFunc=t.queryFunc||null,this.collection=e,this.filteredrows=[],"undefined"!=typeof t.queryObj&&null!==t.queryObj?this.find(t.queryObj,t.firstOnly):"undefined"!=typeof t.queryFunc&&null!==t.queryFunc?this.where(t.queryFunc):(this._calculateRange=function(e,t,r){var n=[].concat(this.collection.toArray()),l=this.collection.binaryIndices[t].values,i=0,u=l.length-1,c=0;if(0===n.length)return[0,-1];var o=n[l[i]][t],a=n[l[u]][t];switch(e){case"$eq":if(ltHelper(r,o,!1)||gtHelper(r,a,!1))return[0,-1];break;case"$dteq":if(ltHelper(r,o,!1)||gtHelper(r,a,!1))return[0,-1];break;case"$gt":if(gtHelper(r,a,!0))return[0,-1];break;case"$gte":if(gtHelper(r,a,!1))return[0,-1];break;case"$lt":if(ltHelper(r,o,!0))return[0,-1];if(ltHelper(a,r,!1))return[0,n.length-1];break;case"$lte":if(ltHelper(r,o,!1))return[0,-1];if(ltHelper(a,r,!0))return[0,n.length-1]}for(;i<u;)c=i+u>>1,ltHelper(n[l[c]][t],r,!1)?i=c+1:u=c;var s=i;for(u=l.length-1;i<u;)c=i+u>>1,ltHelper(r,n[l[c]][t],!1)?u=c:i=c+1;var f=u,h=n[l[s]][t],g=n[l[f]][t];switch(e){case"$eq":return h!==r?[0,-1]:(g!==r&&f--,[s,f]);case"$dteq":return h>r||h<r?[0,-1]:((g>r||g<r)&&f--,[s,f]);case"$gt":return ltHelper(g,r,!0)?[0,-1]:[f,n.length-1];case"$gte":return ltHelper(h,r,!1)?[0,-1]:[s,n.length-1];case"$lt":return 0===s&&ltHelper(h,r,!1)?[0,0]:[0,s-1];case"$lte":return g!==r&&f--,0===f&&ltHelper(g,r,!1)?[0,0]:[0,f];default:return[0,n.length-1]}},this.$and=function(e){for(var t=0;t<e.length;t++){if(0==this.collection.length)return this;this._find(e[t])}return this},this.$or=function(e){this.collection.length},this)},l=function(t,l){if(0===t.length)return[];var i,u,c,o=l||"getAll";if(e.isObject(o))for(i in o)if(r.call(o,i)){u=i,c=o[i];break}return u&&"getAll"!==o?"$and"===u||"$or"===u?new n(t)[u](o).data():void 0:[].concat(t.toArray())},i={findByConditions:function(e,r){if(!(e instanceof t))return console.warn("collection must be a instance of esri.core.Collection."),[];null==r&&(r="getAll");l(e,{queryObj:r})}};return i});